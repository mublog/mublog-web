(()=>{var be=Object.defineProperty,ke=Object.prototype.hasOwnProperty,le=Object.getOwnPropertySymbols,Re=Object.prototype.propertyIsEnumerable,m=Object.assign,$=(e,r)=>{var t={};for(var a in e)ke.call(e,a)&&r.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&le)for(var a of le(e))r.indexOf(a)<0&&Re.call(e,a)&&(t[a]=e[a]);return t},u=(e,r,t)=>(typeof r!="symbol"&&(r+=""),r in e?be(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t);function z(e){e.$el=document.createElement(e.$tagRef),Object.assign(e.nativeElement,e.$propsRef);for(let r in e.$propsRef)e.$states.set(r,e.$propsRef[r]);e.$propsRef&&e.$propsRef.styles&&e.$styles.addGroup(e.$propsRef.styles),e.append(...e.$childrenRef)}function H(e,r){for(let t in r)e.set(t,r[t])}function W(e,r,t){e.has(r)&&e.get(r)!==t&&(e.$states.set(r,t),e.nativeElement[r]=t,e.signal(r,t))}function G(e,r){for(let t of r){let a;typeof t=="string"?a=document.createTextNode(t):t instanceof l?(a=t.nativeElement,t.has("key")&&e.$children.set(t.get("key"),t)):t instanceof Element&&(a=t),a&&e.nativeElement.appendChild(a)}}function D(e){let r,t=0,a=e.length;for(t;t<a;t++)r=Math.imul(31,r)+e.charCodeAt(t)|0;return r.toString(36)}const me=document.createElement("style");document.head.appendChild(me);const I=me.sheet,U=new Map;class J{constructor(e){u(this,"$map",new Map);u(this,"$node");this.$node=e}has(e){return this.$map.has(e)}get(e){return this.$map.get(e)}add(e){for(let r in e){let t=r.replace(/([A-Z])/g,"-$1").toLowerCase(),a=`${t}: ${e[r]};`,o="r-"+D(a),n=`.${o} { ${a} }`,i=this.get(t);U.has(o)||(U.set(o,n),I.insertRule(n,I.rules.length)),i?i!==o&&(this.$map.set(t,o),this.$node.nativeElement.classList.replace(i,o)):(this.$map.set(t,o),this.$node.nativeElement.classList.add(o))}}addGroup(e){let r="g-",t="",a="";for(let o in e){let n=o.replace(/([A-Z])/g,"-$1").toLowerCase();t+=`${n}: ${e[o]};`}return r+=D(t),a=`.${r} { ${t} }`,U.has(r)||(U.set(r,a),I.insertRule(a,I.rules.length)),this.$node.nativeElement.classList.add(r),r}}class K{constructor(e){u(this,"$map",new Map);u(this,"$node");this.$node=e}has(e){return this.$map.has(e)}get(e){return this.$map.get(e)}add(e,r){return this.has(e)||this.$map.set(e,[]),this.get(e).push(r),this}del(e,r){if(!this.has(e)){let t=this.get(e),a=t.indexOf(r);a>=0&&t.splice(a,1)}return this}run(e,r){return this.$map.has(e)&&this.$map.get(e).forEach(t=>t(this.$node,...r)),this}}class B{constructor({tag:e,props:r,children:t}){u(this,"$tagRef");u(this,"$propsRef");u(this,"$childrenRef");u(this,"$el");u(this,"$states",new Map);u(this,"$styles",new J(this));u(this,"$signals",new K(this));u(this,"$children",new Map);this.$tagRef=e,this.$propsRef=r,this.$childrenRef=t,z(this)}get nativeElement(){return this.$el}update(e){return H(this,e),this}child(e){return this.$children.get(e)}has(e){return this.$states.has(e)}get(e){return this.$states.get(e)}set(e,r){return W(this,e,r),this}style(e){return this.$styles.add(e),this}addSignal(e,r){return this.$signals.add(e,r),this}removeSignal(e,r){return this.$signals.del(e,r),this}signal(e,...r){return this.$signals.run(e,r),this}mount(e){return e.replaceWith(this.nativeElement),this}unmount(){return this.nativeElement.remove(),this}appendTo(e){return e.appendChild(this.nativeElement),this}append(...e){return G(this,e),this}addEvent(e,r){return this.$signals.has(`@${e}`)||this.nativeElement.addEventListener(e,t=>this.signal(`@${e}`,t),!1),this.addSignal(`@${e}`,r),this}removeEvent(e,r){return this.removeSignal(`@${e}`,r),this}mixin(e){return Object.assign(this,e),this}static create(e,r=null,...t){return new B({tag:e,props:r,children:t})}}var l=B;const Ae=/\*/g,Ne=/\:([a-zA-Z]+)/gi,Te="(?<$1>[^\\/\\:\\?]+?)",Ce="^/",Le="/?$",Me="(\\S+)?",Pe=/\S+/i,De=/\/\//g,Ie="/",Ue=/(\*\*)+/g,Be="**";function Z(e){if(e.startsWith("/"))throw new Error("RoutePath cannot start with an '/'");if(e.endsWith("/"))throw new Error("RoutePath cannot end with an '/'");return e==="**"?Pe:(e=e.replace(Ae,Me),e=e.replace(Ne,Te),e=e.replace(De,Ie),e=e.replace(Ue,Be),new RegExp(Ce+e+Le))}function q(e){let r=[],t=0;for(;e[t];){let{component:a,path:o,title:n,children:i,activates:p}=e[t],v=Z(o);p=[...new Set(p)],r.push({title:n,matcher:v,component:a,activates:p}),i&&e.splice(t+1,0,...i.map(x=>(x.activates&&p?x.activates=[...p,...new Set(x.activates)]:p&&(x.activates=p),x.path=o+"/"+x.path,x))),t++}return r}async function Q(e,r){if(e)try{for(let t of e)if(await t(r)!==!0)return!1}catch(t){return console.error(t),!1}return!0}function ce(e,r){let t=e.exec(r);return t.groups?m({},t.groups):{}}async function X(e,r){let t=0;for(;e[t];){let a=e[t];if(!a.matcher.test(r)){t++;continue}a.params=ce(a.matcher,r);let o=await Q(a.activates,a.params);if(o)return a;t++;continue}}async function Y(e,r){let t=await X(e,r);if(!t)return;let{component:a,title:o,params:n}=t,i="";o&&(typeof o=="function"?i=o(n):typeof o=="string"&&(i=o));let p=await a(n);return{title:i,params:n,component:p}}async function ee(e,r,t){r.title&&(document.title=r.title),history.replaceState(r.params,document.title,t),e.nativeElement.innerHTML="",e.append(r.component)}var ue=()=>location.pathname+location.search+location.hash;const de=new PopStateEvent("popstate");function te(e,r){const t=q(r);let a,o,n;async function i(){let p=ue();a&&a();let v=await Y(t,p);v?ee(e,v,p):n&&n(),o&&o()}return i(),addEventListener("popstate",i,!1),e.mixin({onLoad(p){a=p},onLoadEnd(p){o=p},onLoadError(p){n=p},activateRoute(p){history.pushState(null,"",p),dispatchEvent(de)},createRoute(p){p.addEvent("click",(v,x)=>{let pe=p.nativeElement.href;x.preventDefault(),pe&&(history.pushState(null,"",pe),dispatchEvent(de))})}})}var fe={chocRouter:te},s={home:"Startseite",login:"Einloggen",register:"Registrieren",logout:"Ausloggen",error:"Fehler",navigation:"Navigation",name:"Name",alias:"Benutzername",password:"Passwort",loginSuccess:"Erfolgreich eingeloggt",loginSuccessMessage:"Du bist nun eingeloggt",loginFailed:"Einloggen fehlgeschlagen",loginFailedMessage:"Benutzer existiert nicht oder inkorrekte Eingaben",logoutMessage:"Du bist nun abgemeldet",routeNotFound:"Seite '$url' nicht gefunden.",enterAccount:"Logge dich in dein Konto ein",createAccount:"Erstelle ein Konto",loginReason:"Dein Grund zum Einloggen",noAccount:"Noch kein Konto?",secondsAgo:"Vor $n Sekunden",secondAgo:"Vor einer Sekunde",minutesAgo:"Vor $n Minuten",minuteAgo:"Vor einer Minute",hoursAgo:"Vor $n Stunden",hourAgo:"Vor einer Stunde",daysAgo:"Vor $n Tagen",dayAgo:"Vor einem Tag",weeksAgo:"Vor $n Wochen",weekAgo:"Vor einer Woche",monthsAgo:"Vor $n Monaten",monthAgo:"Vor einem Monat",yearsAgo:"Vor $n Jahren",yearAgo:"Vor einem Jahr"};const _=[{id:1,alias:"iljushka",name:"Ilja",profileImageUrl:"https://picsum.photos/200",password:"passwort"},{id:2,alias:"tani",name:"Tani",profileImageUrl:"https://picsum.photos/300",password:"passwort"}],_e=[{id:1,datePosted:Date.now()-5e5,dateEdited:Date.now()-200,user:1,likeAmount:10,textContent:"ahoooo"},{id:2,datePosted:Date.now()-15e3,dateEdited:Date.now()-3e3,user:2,likeAmount:420,textContent:"awoooooo"}];async function j(){return new Promise(e=>setTimeout(e,Math.round(Math.random()*500)))}async function he(e){return await j(),_e.filter(e).map(r=>{let t=m({},r);return t.user=_.find(a=>a.id===r.user),t})}async function ge({alias:e}){return await j(),_.find(r=>r.alias===e)}async function ye({alias:e}){return await j(),!!_.find(r=>r.alias===e)}class d{static isUser(){return!!d.user}static async isAuthorized(){return await j(),d.isUser()}static async isUnauthorized(){return await j(),!d.isUser()}static async login(e,r){return await j(),d.user=_.find(t=>t.alias===e&&t.password===r),d.isUser()}static async logout(){await j(),d.user=void 0}}u(d,"user");function f(t,...r){var e=$(t,[]);let a="box";return e.className&&(a+=" "+e.className,delete e.className),l.create("div",m(m({},e),{className:a}),...r)}function O(e,r=0,t=0){function a(n,i){return{left:`${n}%`,top:`${i}%`}}let o=l.create("div",{className:`arrow arrow-${e}`});return(r||0)&&o.style(a(r,t)),o.mixin({updateType(n){return o.nativeElement.className=`arrow arrow-${n}`,o},updateAxis(n,i){return o.style(a(n,i)),o}})}function h(){return l.create("div",{className:"seperator"})}function y(t,...r){var e=$(t,[]);let a="title";return e.className&&(a+=" "+e.className,delete e.className),l.create("div",m(m({},e),{className:a}),...r)}function w(e,...r){let t="label",a=e.labelText;return delete e.labelText,e.className&&(t+=" "+e.className,delete e.className),l.create("div",m(m({},e),{className:t}),l.create("label",{className:"label-content"},a),...r)}function E(e){let r=l.create("input",e);return l.create("div",{className:"input"},r).mixin({get ref(){return r.nativeElement}})}function T(e,...r){let t="button";return e.className&&(t+=" "+e.className,delete e.className),l.create("button",m(m({},e),{className:t}),l.create("div",{className:"button-content"},...r))}function c(e,...r){let t={display:"flex"};return e.gap&&(t.gap=e.gap,delete e.gap),e.direction&&(t.flexDirection=e.direction,delete e.direction),e.alignItems&&(t.alignItems=e.alignItems,delete e.alignItems),l.create("div",m(m({},e),{styles:t}),...r)}function re(t){var{dateTime:e}=t,r=$(t,["dateTime"]);let[a,o]=xe(e),n=l.create("time",m(m({},r),{innerText:o})),i=setInterval(p,a);function p(){let[v,x]=xe(e);v!==a&&(a=v),Oe(n)&&n.update({innerText:x}),n.nativeElement.isConnected||(clearInterval(i),n.unmount(),n=void 0)}return n}function xe(e){let r=Math.floor((Date.now()-e)/1e3),t,a;return t=Math.floor(r/31536e3),a=6048e5,t==1?[a,s.yearAgo]:t>1?[a,b(s.yearsAgo,t)]:(t=Math.floor(r/2592e3),t==1?[a,s.monthAgo]:t>1?[a,b(s.monthsAgo,t)]:(t=Math.floor(r/604800),t==1?[a,s.weekAgo]:t>1?[a,b(s.monthsAgo,t)]:(t=Math.floor(r/86400),a=36e4,t==1?[a,s.dayAgo]:t>1?[a,b(s.daysAgo,t)]:(t=Math.floor(r/3600),a=6e4,t==1?[a,s.hourAgo]:t>1?[a,b(s.hoursAgo,t)]:(t=Math.floor(r/60),a=1e4,t==1?[a,s.minuteAgo]:t>1?[a,b(s.minutesAgo,t)]:(t=Math.floor(r),a=1e3,t==1?[a,s.secondAgo]:[a,b(s.secondsAgo,t)]))))))}function b(e,r){return e.replace("$n",r+"")}function Oe(e){if(!(e.nativeElement instanceof Element))return!1;const{top:r,bottom:t}=e.nativeElement.getBoundingClientRect();return(r&&t)===0?!1:r<innerHeight&&t>=0}function g(e,...r){return l.create("div",e,...r)}function A(e,...r){return l.create("span",e,...r)}const Fe=new PopStateEvent("popstate");function k(e,...r){return l.create("a",e,...r).addEvent("click",(t,a)=>{a.preventDefault(),N(e.href)})}function N(e){history.pushState(null,null,e),dispatchEvent(Fe)}function ve(e,...r){return l.create("a",e,...r)}function C({id:e,user:{alias:r,name:t,profileImageUrl:a},textContent:o,likeAmount:n,datePosted:i,dateEdited:p}){let v=g({id:`post-${e}`,className:"post"},c({gap:"8px"},k({href:`/user/${r}`,className:"user-image-wrap"},g({className:"user-image"}).style({backgroundImage:`url("${a}")`}),g({className:"user-image-frame"})),f({className:"post-content"},O("top-left"),y({},c({gap:"8px"},k({href:`/user/${r}`,className:"user-link"},c({gap:"8px",className:"user"},A({className:"user-name"},t),A({className:"user-alias"},r))),re({dateTime:i,title:p,className:"datetime"}))),h(),g({className:"user-content"},f({className:"text-content"},o)),h(),c({gap:"8px"},c({gap:"8px",alignItems:"center"},A({},String(n)),A({},"Like")),A({className:"post-menu"},"Menu")))));return v}function R(e){return{if(r){return r&&(e.$el=document.createComment("hidden")),e}}}function S(e){return e.mixin({async while(r){return e.nativeElement.classList.add("loading-circle"),await r(),e.nativeElement.classList.remove("loading-circle"),e}}).addSignal("while",(r,t)=>r.while(t))}class F{static async fetch(e,r,t={}){let{body:a,responseType:o}=t;a?a=JSON.stringify(a):a=void 0;try{let n=await fetch(e,{method:r,body:a}),i={status:n.status,content:void 0};switch(o){case"JSON":i.content=await n.json();break;case"Text":i.content=await n.text();break;case"Blob":i.content=await n.blob()}return i}catch(n){console.error(n)}}}let er=F.fetch("http://localhost:3000/posts","GET");async function ae(){const e=c({direction:"column",gap:"8px"},S(g({key:0,className:"post-container"})).addSignal("refresh",t=>{t.while(async()=>{let a=(await F.fetch("http://localhost:3000/posts","GET",{responseType:"JSON",body:void 0})).content;t.nativeElement.innerHTML="",t.append(...a.map(o=>C(o)))})}).signal("refresh")).addSignal("refresh",t=>t.child(0).signal("refresh"));let r=setInterval(()=>{e.signal("refresh")},1e4);return e}async function oe({alias:e}){let r=await ge({alias:e});const t=c({direction:"column",gap:"8px"},S(g({key:0,className:"post-container"})).addSignal("refresh",o=>{o.while(async()=>{let n=await he(i=>i.user===r.id);o.nativeElement.innerHTML="",o.append(...n.map(i=>C(i)))})}).signal("refresh")).addSignal("refresh",o=>o.child(0).signal("refresh"));let a=setInterval(()=>{t.signal("refresh")},1e4);return t}function L(t,...r){var e=$(t,[]);let a=[];const o=l.create("form",e,...r).mixin({onSubmit(n){return a.push(n),o}}).addSignal("submit",(n,i)=>{i.preventDefault(),a.forEach(p=>p(n,i))}).addEvent("submit",(n,i)=>n.signal("submit",i));return o}const we="^([a-z][a-z0-9]{4,16})$",Ee="^.{8,}$";function Ve(e,r,t={timeout:5e3}){let{timeout:a,removeOnClick:o}=t,n=f({className:"notification"},O("top-right"),R(y({className:"notification-title"},e)).if(!e),R(h()).if(!e),r).style({animation:"notification-slide 250ms ease-in-out 0ms 1 normal none"}).mixin({slideOut(i){let p=i>250?i-250:0;setTimeout(()=>n.style({animation:`notification-slide 250ms ease-in-out ${p}ms 1 reverse none`}),p),setTimeout(()=>n.unmount(),i)}});return a&&n.slideOut(a),o&&n.addEvent("click",i=>i.unmount()),n}const Se=function(){let e=g({id:"notifications"},g({key:"wrapper",className:"notification-wrapper"})).mixin({push(r,t,a){e.child("wrapper").append(Ve(r,t,a))}});return e}();Se.appendTo(document.body);var M=Se;const $e=function(){let e=async()=>{let t=await d.isAuthorized();return[k({href:"/"},s.home),R(k({href:"/login"},s.login)).if(t),R(k({href:"/register"},s.register)).if(t),R(ve(null,s.logout).addEvent("click",ze)).if(!t)]},r=f({id:"navigation"},y({},s.navigation),h(),S(g({key:"list",className:"list"})));return r.child("list").addSignal("load",async t=>{t.signal("while",async()=>{let a=await e();t.nativeElement.innerHTML="",t.append(...a)})}),r.addSignal("refresh",t=>t.child("list").signal("load")),r.signal("refresh"),r}();var V=$e;async function ze(){await d.logout(),N("/login"),$e.signal("refresh"),M.push(null,s.logoutMessage)}async function ne(){const e=E({placeholder:". . .",required:!0,pattern:we}),r=E({placeholder:"********",type:"password",required:!0,pattern:Ee});return f({id:"login"},y({},s.enterAccount),h(),L({},c({gap:"8px",direction:"column"},c({gap:"8px",direction:"row"},w({labelText:s.alias},e),w({labelText:s.password},r))),h(),c({gap:"8px",direction:"row"},T({type:"submit"},s.login),T({type:"button"},s.noAccount).addEvent("click",()=>N("/register")))).onSubmit(async(t,a)=>{S(t).while(async()=>{let o=await d.login(e.ref.value,r.ref.value);o?(V.signal("refresh"),N("/"),M.push(null,s.loginSuccessMessage)):M.push(null,s.loginFailedMessage)})}))}async function se(){let e=f({id:"register"},y({},s.createAccount),h(),L({},c({gap:"8px",direction:"row"},w({labelText:s.alias},E({placeholder:s.alias})),w({labelText:s.name},E({placeholder:s.name}))),c({gap:"8px",direction:"row"},w({labelText:s.password},E({placeholder:s.password,type:"password"})),w({labelText:s.password},E({placeholder:s.password,type:"password"}))),h(),c({gap:"8px",direction:"row"},T({type:"submit"},s.register))));return e}async function ie(){return f({id:"route-not-found"},y({},s.error),h(),f({className:"message"},s.routeNotFound.replace("$url",location.pathname)))}const P=fe.chocRouter(l.create("div",{id:"router",className:"loading"}),[{path:"",title:s.home,component:ae},{path:"login/?*",title:s.login,component:ne,activates:[d.isUnauthorized]},{path:"register/?*",title:s.register,component:se,activates:[d.isUnauthorized]},{path:"user/:alias",title:({alias:e})=>`.${e}//`,component:oe,activates:[ye]},{path:"**",title:s.error,component:ie}]);P.onLoad(()=>P.nativeElement.classList.add("loading"));P.onLoadEnd(()=>P.nativeElement.classList.remove("loading"));var je=P;const He=l.create("div",{id:"app"},V,l.create("div",{id:"content"},je));He.mount(document.getElementById("app"));})();
